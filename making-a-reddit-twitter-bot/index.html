<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Bite Sized Python Tips | Making a Reddit + twitter Bot</title>
  <meta property="og:type" content="article" />
  <link rel="alternate" type="application/rss+xml" title="Bite Sized Python Tips Â» Feed" href="../feeds/all.atom.xml">
  <meta property="article:publisher" content="https://www.facebook.com/freepythontips">
  <meta property="article:author" content="https://www.facebook.com/profile.php?id=1530901081">
  <meta property="og:image" content="http://0.gravatar.com/blavatar/6c1d474724ac198295b95c49642a34b3?s=200">
  <meta name="twitter:site" content="@yasoobkhalid">
  <meta name="description" content="Hi there pythonistas. I hope you are all fine. In this post I am going to teach you how we can make a Reddit + Twitter bot. What this bot will do is that it will copy post titles and url from any subreddit that you want and then it will ..." />
    <meta property="article:tag" content="bot" />
    <meta property="article:tag" content="python" />
    <meta property="article:tag" content="python+reddit" />
    <meta property="article:tag" content="pytwitter" />
    <meta property="article:tag" content="reddit" />
    <meta property="article:tag" content="redditpy" />
    <meta property="article:tag" content="tutorial" />
    <meta property="article:tag" content="twitter" />
    <link rel="stylesheet" href="../theme/css/main.css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Raleway:400,200" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="../images/favicon.ico">
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body id="index" class="home">
<a href="http://www.github.com/yasoob/blog">
<img style="position: absolute; top: 0; left: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub" />
</a>

<!-- AddThis Smart Layers BEGIN -->
<!-- Go to http://www.addthis.com/get/smart-layers to customize -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-529a3f497b3e7850"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'transparent', 
    'follow' : {
      'services' : [
        {'service': 'facebook', 'id': 'freepythontips'},
        {'service': 'twitter', 'id': 'yasoobkhalid'},
        {'service': 'rss', 'id': 'http://feedpress.me/pytips'}
      ]
    }   
  });
</script>
<!-- AddThis Smart Layers END -->    <div id="wrapper">
        <header id="banner" class="body">
            <div>
                <img src="../images/logo.png">
            </div>
            <h1><a href="../">Bite Sized Python Tips</a></h1>
            <br/><nav><ul>
                <li>|<a href="../about">About</a>|</li> 
                <li>|<a href="../pycrumbs">Beginner's Delight</a>|</li> 
                <li>|<a href="../python-news">News</a>|</li> 
            </ul></nav>
        </header>
        <hr>
<section id="content" class="body">
  <article class="container">
    <header>
      <h1 class="entry-title">Making a Reddit + twitter Bot</h1>
      <span class="date">September 14, 2013</span>
    </header>

    <div class="entry-content">
      <p>Hi there pythonistas. I hope you are all fine. In this post I am going
to teach you how we can make a Reddit + Twitter bot. What this bot will
do is that it will copy post titles and url from any subreddit that you
want and then it will post them to twitter keeping the 140 characters
length in mind.<!--more--> Firstly let me tell you what Reddit is.
Reddit is a social link sharing site where good links are upvoted and
bad links are down voted. So lets start.</p>
<p><strong>Required External Libraries</strong><br />
<strong>1.</strong> Praw - (Reddidt API wrapper in python) <code>pip install praw</code><br />
<strong>2.</strong> Requests - (HTTP library) <code>pip install requests</code><br />
<strong>3.</strong> Tweepy - (Twitter python API) <code>pip install tweepy</code></p>
<p><strong>First step - Register Yourself</strong><br />
So first of all you will have to register an app on
http://dev.twitter.com/apps and after registering copy the</p>
<div class="codehilite"><pre><span class="n">access</span> <span class="n">token</span>
<span class="n">access</span> <span class="n">token</span> <span class="n">secret</span>
<span class="n">consumer</span> <span class="n">key</span>
<span class="n">consumer</span> <span class="n">secret</span>
</pre></div>


<p>You will have to edit the permissions for your app under the settings
tab and grant your application read and write permission. So now we are
ready to move on.</p>
<p><strong>Start by importing</strong><br />
So now lets start writing our script. First of all we will have to
import the required libraries and set up some basic variables:</p>
<div class="codehilite"><pre><span class="nb">import</span> <span class="n">praw</span>
<span class="nb">import</span> <span class="n">json</span>
<span class="nb">import</span> <span class="n">requests</span>
<span class="nb">import</span> <span class="n">tweepy</span>
<span class="nb">import</span> <span class="nb">time</span>

<span class="n">access_token</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN HERE&#39;</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN SECRET HERE&#39;</span>
<span class="n">consumer_key</span> <span class="o">=</span> <span class="s">&#39;YOUR CONSUMER KEY HERE&#39;</span>
<span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">&#39;YOUR CONSUMER SECRET HERE&#39;</span>
</pre></div>


<p><strong>Initiate connection with Reddit</strong><br />
Now we have to initiate connection with Reddit. Lets define a function
to do just that.</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">setup_connection_reddit</span><span class="p">(</span><span class="n">subreddit</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;[bot] setting up connection with Reddit&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">praw</span><span class="o">.</span><span class="n">Reddit</span><span class="p">(</span><span class="s">&#39;yasoob_python reddit twitter bot &#39;</span>
                <span class="s">&#39;monitoring %s&#39;</span> <span class="nv">%</span><span class="err">(</span><span class="nv">subreddit</span><span class="p">))</span> 
    <span class="n">subreddit</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_subreddit</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subreddit</span>
</pre></div>


<p>This method connects with Reddit and gets the subreddit of our choice
and then returns that subreddit for us to work further with.</p>
<p><strong>Get posts and links from Reddit</strong><br />
So now we have to define a function that gets the list of posts and
there urls from Reddit for us. So lets just do that as well.</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">tweet_creator</span><span class="p">(</span><span class="n">subreddit_info</span><span class="p">):</span>
    <span class="n">post_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">post_ids</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="k">print</span> <span class="s">&quot;[bot] Getting posts from Reddit&quot;</span>
    <span class="k">for</span> <span class="n">submission</span> <span class="n">in</span> <span class="n">subreddit_info</span><span class="o">.</span><span class="n">get_hot</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
                <span class="c1"># strip_title function is defined later</span>
        <span class="n">post_dict</span><span class="p">[</span><span class="n">strip_title</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">title</span><span class="p">)]</span> <span class="o">=</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span>
        <span class="n">post_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;[bot] Generating short link using goo.gl&quot;</span>
    <span class="n">mini_post_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">post</span> <span class="n">in</span> <span class="n">post_dict:</span>
        <span class="n">post_title</span> <span class="o">=</span> <span class="n">post</span>
        <span class="n">post_link</span> <span class="o">=</span> <span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span>   
                <span class="c1"># the shorten function is defined later     </span>
        <span class="n">short_link</span> <span class="o">=</span> <span class="n">shorten</span><span class="p">(</span><span class="n">post_link</span><span class="p">)</span>
        <span class="n">mini_post_dict</span><span class="p">[</span><span class="n">post_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">short_link</span> 
    <span class="k">return</span> <span class="n">mini_post_dict</span><span class="p">,</span> <span class="n">post_ids</span>
</pre></div>


<p>First of all we are declaring a dictionary to hold the post title and
link and after that we are making a list to hold the unique ids of every
post that we grab. This is used to track which posts we have already
grabbed. After that we are looping over the posts and appending values
to the dictionary and the list. If you use twitter very frequently then
you know that how disgusting long links look like so in order to tackle
that we are using goo.gl to generate short links for us. That's the next
thing we have done in the above function. We loop over the post dict and
make a short link for every link and append it to a new dictionary which
is <code>mini_post_dict</code>.</p>
<p><strong>No one likes long links</strong><br />
Now lets define a function which will actually shorten the links for
us. So here it is:</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">shorten</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;application/json&#39;</span><span class="p">}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;longUrl&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="nb">link</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">link</span>
</pre></div>


<p>The above function contains a header and a payload which we are going to
send to google and after that google will return the short link in the
form of json.</p>
<p><strong>Twitter hates more than 140 characters</strong><br />
If you use twitter regularly then I am sure that you know that twitter
does not like tweets that are more than 140 characters. So in order to
tackle that lets define a function that will truncate long tweets to
short ones.</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">strip_title</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">94</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">[:</span><span class="mi">93</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span>
</pre></div>


<p>In the above method we will pass a title and the above method will check
that whether the title is 93 characters or more. If it is more than 93
characters then it will truncate it and append three dots at its end.</p>
<p><strong>Dealing with duplicate posts</strong><br />
So now we have started to shape our final script. There is one thing
that we have to keep in mind. No one likes duplicate posts so we have to
make sure that we do not post same tweets over and over again. In order
to tackle this issue we are going to make a file with the name of
posted_posts.txt . When ever we grab a post from Reddit we will add
it's ID to this file and when posting to twitter we will check whether
the post with this ID has already been posted or not. Lets define two
more functions. The first one will write the IDs to file and the second
one will check whether the post is already posted or not.</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">add_id_to_file</span><span class="p">(</span><span class="n">id</span><span class="p">):</span>
    <span class="n">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;posted_posts.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">file:</span>
        <span class="n">file</span><span class="o">.</span><span class="nb">write</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="n">def</span> <span class="n">duplicate_check</span><span class="p">(</span><span class="n">id</span><span class="p">):</span>
    <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;posted_posts.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">file:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="n">in</span> <span class="n">file:</span>
            <span class="k">if</span> <span class="n">id</span> <span class="n">in</span> <span class="n">line:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">found</span>
</pre></div>


<p><strong>Make a function for twitter will ya</strong><br />
So now lets make our one of the main function. This function is
actually going to post to twitter.</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">tweeter</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">):</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">post</span><span class="p">,</span> <span class="n">post_id</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">duplicate_check</span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[bot] Posting this link on twitter&quot;</span>
            <span class="k">print</span> <span class="n">post</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; #Python #reddit #bot&quot;</span>
            <span class="n">api</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">post</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; #Python #reddit #bot&quot;</span><span class="p">)</span>
            <span class="n">add_id_to_file</span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span>
            <span class="nb">time</span><span class="o">.</span><span class="nb">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[bot] Already posted&quot;</span>
</pre></div>


<p>Firstly we setup connection with twitter by using the credentials we
defined in the beginning. After that we loop over the post_dict and
post_ids. Then we check for duplicate posting. If it is not previously
posted then we post it and add the id of the post in the
<code>posted_posts.txt</code> file. After posting we wait for 30 seconds so that we
do not spam twitter with tweets.</p>
<p><strong>Wheres the main function bud</strong><br />
So lets define our last function. This function will co ordinate with
all other functions. Here is the code for that last function:</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">main</span><span class="p">():</span>
    <span class="n">subreddit</span> <span class="o">=</span> <span class="n">setup_connection_reddit</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span> <span class="o">=</span> <span class="n">tweet_creator</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>
    <span class="n">tweeter</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">)</span>
</pre></div>


<p>So now we are ready just add this little line at the end as well:</p>
<div class="codehilite"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>This checks whether the script is directly executed or is it imported.
If it is directly executed only then the main() function is executed.</p>
<p><strong>Complete code</strong><br />
Here is the complete script:</p>
<div class="codehilite"><pre><span class="nb">import</span> <span class="n">praw</span>
<span class="nb">import</span> <span class="n">json</span>
<span class="nb">import</span> <span class="n">requests</span>
<span class="nb">import</span> <span class="n">tweepy</span>
<span class="nb">import</span> <span class="nb">time</span>

<span class="n">access_token</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN HERE&#39;</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN SECRET HERE&#39;</span>
<span class="n">consumer_key</span> <span class="o">=</span> <span class="s">&#39;YOUR CONSUMER KEY HERE&#39;</span>
<span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">&#39;YOUR CONSUMER SECRET HERE&#39;</span>

<span class="n">def</span> <span class="n">strip_title</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">94</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">[:</span><span class="mi">93</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span>

<span class="n">def</span> <span class="n">tweet_creator</span><span class="p">(</span><span class="n">subreddit_info</span><span class="p">):</span>
    <span class="n">post_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">post_ids</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="k">print</span> <span class="s">&quot;[bot] Getting posts from Reddit&quot;</span>
    <span class="k">for</span> <span class="n">submission</span> <span class="n">in</span> <span class="n">subreddit_info</span><span class="o">.</span><span class="n">get_hot</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">post_dict</span><span class="p">[</span><span class="n">strip_title</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">title</span><span class="p">)]</span> <span class="o">=</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span>
        <span class="n">post_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;[bot] Generating short link using goo.gl&quot;</span>
    <span class="n">mini_post_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">post</span> <span class="n">in</span> <span class="n">post_dict:</span>
        <span class="n">post_title</span> <span class="o">=</span> <span class="n">post</span>
        <span class="n">post_link</span> <span class="o">=</span> <span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span>         
        <span class="n">short_link</span> <span class="o">=</span> <span class="n">shorten</span><span class="p">(</span><span class="n">post_link</span><span class="p">)</span>
        <span class="n">mini_post_dict</span><span class="p">[</span><span class="n">post_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">short_link</span> 
    <span class="k">return</span> <span class="n">mini_post_dict</span><span class="p">,</span> <span class="n">post_ids</span>

<span class="n">def</span> <span class="n">setup_connection_reddit</span><span class="p">(</span><span class="n">subreddit</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;[bot] setting up connection with Reddit&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">praw</span><span class="o">.</span><span class="n">Reddit</span><span class="p">(</span><span class="s">&#39;yasoob_python reddit twitter bot &#39;</span>
                <span class="s">&#39;monitoring %s&#39;</span> <span class="nv">%</span><span class="err">(</span><span class="nv">subreddit</span><span class="p">))</span> 
    <span class="n">subreddit</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_subreddit</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subreddit</span>

<span class="n">def</span> <span class="n">shorten</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;application/json&#39;</span><span class="p">}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;longUrl&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="nb">link</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">link</span>

<span class="n">def</span> <span class="n">duplicate_check</span><span class="p">(</span><span class="n">id</span><span class="p">):</span>
    <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;posted_posts.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">file:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="n">in</span> <span class="n">file:</span>
            <span class="k">if</span> <span class="n">id</span> <span class="n">in</span> <span class="n">line:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">found</span>

<span class="n">def</span> <span class="n">add_id_to_file</span><span class="p">(</span><span class="n">id</span><span class="p">):</span>
    <span class="n">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;posted_posts.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">file:</span>
        <span class="n">file</span><span class="o">.</span><span class="nb">write</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="n">def</span> <span class="n">main</span><span class="p">():</span>
    <span class="n">subreddit</span> <span class="o">=</span> <span class="n">setup_connection_reddit</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span> <span class="o">=</span> <span class="n">tweet_creator</span><span class="p">(</span><span class="n">subreddit</span><span class="p">)</span>
    <span class="n">tweeter</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">)</span>

<span class="n">def</span> <span class="n">tweeter</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">):</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">post</span><span class="p">,</span> <span class="n">post_id</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">post_dict</span><span class="p">,</span> <span class="n">post_ids</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">duplicate_check</span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[bot] Posting this link on twitter&quot;</span>
            <span class="k">print</span> <span class="n">post</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; #Python #reddit #bot&quot;</span>
            <span class="n">api</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">post</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">post_dict</span><span class="p">[</span><span class="n">post</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; #Python #reddit #bot&quot;</span><span class="p">)</span>
            <span class="n">add_id_to_file</span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span>
            <span class="nb">time</span><span class="o">.</span><span class="nb">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[bot] Already posted&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Save this file with the name of reddit_bot.py and make a file with the
name of posted_posts.txt and then execute the python script from the
terminal. Your output will look something like this:</p>
<div class="codehilite"><pre><span class="n">yasoob</span><span class="nv">@yasoob:</span><span class="o">~/</span><span class="n">Desktop</span><span class="nv">$</span> <span class="nv">python</span> <span class="n">reddit_bot</span><span class="o">.</span><span class="n">py</span>
<span class="p">[</span><span class="n">bot</span><span class="p">]</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">connection</span> <span class="n">with</span> <span class="n">Reddit</span>
<span class="p">[</span><span class="n">bot</span><span class="p">]</span> <span class="n">Getting</span> <span class="n">posts</span> <span class="n">from</span> <span class="n">Reddit</span>
<span class="p">[</span><span class="n">bot</span><span class="p">]</span> <span class="n">Generating</span> <span class="n">short</span> <span class="nb">link</span> <span class="n">using</span> <span class="n">goo</span><span class="o">.</span><span class="n">gl</span>
<span class="p">[</span><span class="n">bot</span><span class="p">]</span> <span class="n">Posting</span> <span class="n">this</span> <span class="nb">link</span> <span class="n">on</span> <span class="n">twitter</span>
<span class="n">Miloslav</span> <span class="n">Trma</span><span class="err">Ä</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">Structured</span> <span class="n">Logging</span> <span class="n">http:</span><span class="sr">//goo</span><span class="o">.</span><span class="n">gl</span><span class="o">/</span><span class="n">sF8Xgm</span> <span class="c1">#Python #reddit #bot</span>
</pre></div>


<p>And after some time your posted_posts.txt file will look something like
this:</p>
<div class="codehilite"><pre><span class="mi">1</span><span class="n">mb4y4</span>
<span class="mi">1</span><span class="n">mb867</span>
<span class="mi">1</span><span class="n">mb4hl</span>
<span class="mi">1</span><span class="n">mbh3t</span>
<span class="mi">1</span><span class="n">mbni0</span>
<span class="mi">1</span><span class="n">m9bod</span>
<span class="mi">1</span><span class="n">mbhpt</span>
<span class="mi">1</span><span class="n">mbhnc</span>
<span class="mi">1</span><span class="n">mbcp2</span>
<span class="mi">1</span><span class="n">m9d2t</span>
<span class="mi">1</span><span class="n">maeio</span>
<span class="mi">1</span><span class="n">m9bi5</span>
<span class="mi">1</span><span class="n">m8tgr</span>
<span class="mi">1</span><span class="n">m86e4</span>
<span class="mi">1</span><span class="n">ma5r5</span>
<span class="mi">1</span><span class="n">m8fud</span>
<span class="mi">1</span><span class="n">mdh1t</span>
<span class="mi">1</span><span class="n">mbst4</span>
</pre></div>


<p><strong>Goodbye</strong><br />
I hope you enjoyed today's post as much as I enjoyed writing it. I hope
to see you in future with some more tutorials. Do follow my blog to give
me some support and get regular updates. Goodbye till next time.</p>
<footer class="post-info">
  <p>Tags: 
    <a href="../tag/bot.html">bot</a>
    <a href="../tag/python.html">python</a>
    <a href="../tag/pythonreddit.html">python+reddit</a>
    <a href="../tag/pytwitter.html">pytwitter</a>
    <a href="../tag/reddit.html">reddit</a>
    <a href="../tag/redditpy.html">redditpy</a>
    <a href="../tag/tutorial.html">tutorial</a>
    <a href="../tag/twitter.html">twitter</a>
  </p>

</footer><!-- /.post-info -->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-529a3f497b3e7850"></script>
<!-- AddThis Button END -->    </div>
    <hr>
    <div>
    <a href = "http://github.us3.list-manage1.com/subscribe?u=20b1036063aec6dbf068cc8c0&id=4d261653c5" target="_blank"><img src= "../images/subscribe.png" /></a>
    </div><hr><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "making-a-reddit-twitter-bot";
        var disqus_url = "../making-a-reddit-twitter-bot";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://freepytips.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
    <a href="https://plus.google.com/105844092190217759857?rel=author"></a>
  </article>
</section>
        <div class="clear-footer"></div>
    </div>
    <footer id="contentinfo" class="body">
        <div class="social">
            <a href="mailto:yasoob.khld@gmail.com" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x dat-icon"></i>
                </span>
            </a>
            <a href="https://github.com/yasoob" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x dat-icon"></i>
                </span>
            </a>
            <a href="https://www.facebook.com/freepythontips" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-facebook fa-stack-1x dat-icon"></i>
                </span>
            </a>
            <a href="https://twitter.com/yasoobkhalid" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x dat-icon"></i>
                </span>
            </a>
            <a href="http://feedpress.me/pytips" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x dat-icon"></i>
                </span>
            </a>
            <!-- <a class="lastfm" href="http://www.last.fm/user/nortantivirus" target="_blank"></a> -->
        </div>
        <p>
            Â©2013 Bite Sized Python Tips
            <br/>Built with <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>.
        </p>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46059954-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>